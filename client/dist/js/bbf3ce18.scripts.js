!function(){"use strict";window.cfg||(window.cfg={hostAndPort:function(){return"//"+window.location.host},host:function(){return"http://"+window.location.host.replace(/:[0-9]+$/,"")},apiBaseUrl_set:"",apiBaseUrl:function(){return this.apiBaseUrl_set?this.apiBaseUrl_set:(this.hostAndPort().match(/isleofravens.com/)?(this.server="http://app.isleofravens.com",this.basehref="/"):(this.hostAndPort().match(/:8888/)||this.host().match(/(localh|127.0.0|0.0.0)/))&&(this.server="http://localhost:8888/isleofravens/server/",this.basehref="/isleofravens/client/"),this.apiBaseUrl_set=this.server,this.apiBaseUrl_set)}})}();var app=angular.module("isleOfRavensApp",["ngRoute","restangular"]);app.run(["$rootScope",function(rs){rs.baseURL=cfg.baseHref}]),app.config(["$routeProvider","$locationProvider",function($routeProvider,$locationProvider){"use strict";$locationProvider.html5Mode(!0),$routeProvider.when("/",{templateUrl:"js/search/main.html",controller:"MainController"}).when("/player/:playerID",{templateUrl:"js/search/main.html",controller:"MainController"}).otherwise({redirectTo:"/"})}]).run(["Restangular","$rootScope",function(RestProvider,rs){"use strict";RestProvider.setBaseUrl(cfg.apiBaseUrl())}]),app.factory("Api",["Restangular","$rootScope","$q","$location","$http",function(Rest,$rootScope,$q,$location,$http){"use strict";window.Api=this;return{searchPlayers:function(opts){return Rest.all("player/search/").post(opts)},loadPlayerByID:function(playerID){return Rest.one("player/"+playerID).get(playerID)},loadTopPlayers:function(topX){return Rest.all("player/top/").get(topX)},loadTournamentsByPlayer:function(player_id){return Rest.all("player/tournaments/").get(player_id)},loadTournamentRoundsByPlayer:function(tournament_id,player_id){return Rest.all("tournament/rounds/"+tournament_id+"/").get(player_id)}}}]);var MainCtrl=app.controller("MainController",["$scope","Restangular","$routeParams","$route","$location","$q","Api",function($scope,Rest,$routeParams,$route,$location,$q,Api){$scope.search_str="",$scope.players=[],$scope.top_players=[],$scope.loading=!1,$scope.searchPlayer=function(){$scope.loading=!0,Api.searchPlayers({playerName:$scope.search_str}).then(function(res){$scope.players=res.data,console.log($scope.players),$scope.loading=!1})},$scope.loadPlayer=function(id){$scope.loading=!0,Api.loadPlayerByID(id).then(function(res){console.log(res.data),$scope.players.push(res.data),$scope.loading=!1})},$scope.loadTopPlayers=function(topX){Api.loadTopPlayers(topX).then(function(res){$scope.top_players=res.data,console.log($scope.top_players)})},$routeParams.playerID&&$scope.loadPlayer($routeParams.playerID)}]);app.directive("topPlayers",["Api",function(Api){"use strict";return{restrict:"EA",replace:!0,transclude:!1,templateUrl:"js/player/top_players.html",scope:{count:"=",mode:"&"},link:function(scope,elem,attrs){scope.loadTopPlayers=function(topX){Api.loadTopPlayers(topX).then(function(res){scope.top_players=res.data,console.log(scope.top_players)})},scope.count||(scope.count=25),scope.loadTopPlayers(scope.count)}}}]),app.directive("playerDetails",[function(){"use strict";return{restrict:"EA",replace:!0,transclude:!1,templateUrl:"js/player/player_details.html",scope:{player:"=",mode:"&"}}}]),app.directive("playerNemesis",[function(){"use strict";return{restrict:"EA",replace:!0,transclude:!1,templateUrl:"js/player/player_nemesis.html",scope:{player:"=",mode:"&"}}}]),app.directive("playerRival",[function(){"use strict";return{restrict:"EA",replace:!0,transclude:!1,templateUrl:"js/player/player_rival.html",scope:{player:"=",mode:"&"}}}]),app.directive("playerTournaments",["Api",function(Api){"use strict";return{restrict:"EA",replace:!0,transclude:!1,templateUrl:"js/player/player_tournaments.html",scope:{player:"=",mode:"&"},link:function(scope,element,attrs){scope.loadPlayerTournaments=function(){console.log("loading!"),Api.loadTournamentsByPlayer(scope.player.player_id).then(function(res){scope.tournaments=res.data,console.log(scope.tournaments)})}}}}]),app.directive("playerRounds",["Api",function(Api){"use strict";return{restrict:"EA",replace:!0,transclude:!1,templateUrl:"js/player/player_rounds.html",scope:{tid:"=",player:"=",mode:"&"},link:function(scope,element,attrs){scope.loadPlayerRounds=function(){console.log("loading! - "+scope.tid+" -- "+scope.player.player_id),Api.loadTournamentRoundsByPlayer(scope.tid,scope.player.player_id).then(function(res){scope.rounds=res.data,console.log(scope.tournaments)})}}}}]);