!function(){"use strict";window.cfg||(window.cfg={hostAndPort:function(){return"//"+window.location.host},host:function(){return"http://"+window.location.host.replace(/:[0-9]+$/,"")},apiBaseUrl_set:"",apiBaseUrl:function(){return this.apiBaseUrl_set?this.apiBaseUrl_set:(this.hostAndPort().match(/isleofravens.com/)?(this.server="//app.isleofravens.com",this.basehref="/"):this.host().match(/(192.)/)?(console.log(this.hostAndPort()),this.server=this.hostAndPort()+"/isleofravens/server/",this.basehref="/isleofravens/client/"):(this.hostAndPort().match(/:8888/)||this.host().match(/(localh|127.0.0|0.0.0)/))&&(this.server="//localhost:8888/isleofravens/server/",this.basehref="/isleofravens/client/"),this.apiBaseUrl_set=this.server,this.apiBaseUrl_set)}})}();var app=angular.module("isleOfRavensApp",["ngRoute","restangular","templates-main","ui.bootstrap"]);app.run(["$rootScope",function(rs){rs.baseURL=cfg.baseHref}]),app.config(["$routeProvider","$locationProvider",function($routeProvider,$locationProvider){"use strict";$locationProvider.html5Mode(!0),$routeProvider.when("/",{templateUrl:"js/search/main.html",controller:"MainController"}).when("/search",{templateUrl:"js/search/search.html",controller:"SearchController"}).when("/page/:page",{templateUrl:"js/search/main.html",controller:"MainController"}).when("/player/:playerID",{templateUrl:"js/search/main.html",controller:"MainController"}).when("/faq",{templateUrl:"js/faq/faq.html",controller:"FaqController"}).when("/contact",{templateUrl:"js/contact/contact.html",controller:"ContactController"}).otherwise({redirectTo:"/"})}]).run(["Restangular","$rootScope",function(RestProvider,rs){"use strict";RestProvider.setBaseUrl(cfg.apiBaseUrl())}]),app.factory("Api",["Restangular","$rootScope","$q","$location","$http",function(Rest,$rootScope,$q,$location,$http){"use strict";window.Api=this;return{searchPlayers:function(opts){return Rest.all("player/search/").post(opts)},loadPlayerByID:function(playerID){return Rest.one("player/"+playerID).get(playerID)},loadTopPlayers:function(opts){return Rest.all("player/top/?offset="+opts.offset+"&limit="+opts.limit).get("")},loadTournamentsByPlayer:function(player_id){return Rest.all("player/tournaments/").get(player_id)},loadTournamentRoundsByPlayer:function(tournament_id,player_id){return Rest.all("tournament/rounds/"+tournament_id+"/").get(player_id)},loadFactionWinLoss:function(playerID){return Rest.one("player/faction/winloss/"+playerID).get(playerID)},sendMail:function(opts){return console.log("api : "),console.log(opts),Rest.all("send-mail/").post(opts)}}}]);var MainCtrl=app.controller("MainController",["$scope","Restangular","$routeParams","$route","$location","$q","Api","PlayerSearch",function($scope,Rest,$routeParams,$route,$location,$q,Api,PlayerSearch){$scope.search_str="",$scope.players=[],$scope.top_players=[],$scope.loading=!1,$scope.page=1,$routeParams.page&&($scope.page=$routeParams.page),$scope.loadPlayer=function(id){$scope.loading=!0,Api.loadPlayerByID(id).then(function(res){$scope.players.push(res.data),$scope.loading=!1})},$routeParams.playerID&&$scope.loadPlayer($routeParams.playerID)}]);angular.module("templates-main",["js/contact/contact.html","js/faq/faq.html","js/header/header.tpl.html","js/player/faction_winloss.html","js/player/player_details.html","js/player/player_nemesis.html","js/player/player_rival.html","js/player/player_rounds.html","js/player/player_tournaments.html","js/player/top_players.html","js/search/main.html","js/search/search_form.tpl.html","js/search/search.html"]),angular.module("js/contact/contact.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("js/contact/contact.html",'<div class="col-lg-12 col-md-12 col-sm-12">\n  <div class="alert alert-danger" ng-show="error">\n    <button class="close" data-dismiss="alert">x</button>\n    <strong>Error!</strong> An error occured while trying to send message.\n  </div>\n  <div class="alert alert-success" ng-show="success">\n    <button class="close" data-dismiss="alert">x</button>\n    <strong>Success! </strong> Your message was successfully sent.\n  </div>\n  <div ng-if="!success">\n    <div class="form-group" ng-class="{error: contactForm.name.$invalid}">\n    <label>Full Name</label>\n    <input class="form-control" type="text" name="name" ng-model="user.name" required="required" placeholder="Your name">\n      <span class="help-block" ng-show="contactForm.name.$error.required">Required</span>\n    </div>\n    <div class="form-group" ng-class="{error: contactForm.email.$invalid}">\n      <label>Email</label>\n      <input class="form-control" type="email" name="email" ng-model="user.email" required="required" placeholder="Your email address">\n      <span class="help-block" ng-show="contactForm.email.$error.required">Required</span>\n      <span class="help-block" ng-show="contactForm.email.$error.email">Invalid email address</span>\n    </div>\n    <div class="form-group" ng-class="{error: contactForm.message.$invalid}">\n      <label>Message</label>\n      <textarea class="form-control" rows="5" name="message" ng-model="user.message" required="required" placeholder="Your messsage"></textarea>\n      <span class="help-inline" ng-show="contactForm.message.$error.required">Required</span>\n    </div>\n    <button class="btn btn-primary btn-lg btn-block" ng-click="send()" ng-disabled="contactForm.$invalid">Send</button>\n    </div>\n</div>')}]),angular.module("js/faq/faq.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("js/faq/faq.html",'<div class="panel-group" id="accordion">\n\t<div class="panel panel-default" ng-repeat="faq in faqs">\n\t\t<div class="panel-heading">\n\t\t\t<h4 class="panel-title">\n\t\t\t\t<a class="accordion-toggle" ng-class="$index!=0?\'collapsed\':\'\'" href="javascript:void(0);" data-toggle="collapse" data-parent="#accordion" data-target="#collapse{{faq.id}}" aria-expanded="false">{{faq.q}}</a>\n\t\t\t</h4>\n\t\t</div>\n\t\t<div id="collapse{{faq.id}}" class="panel-collapse collapse"  ng-class="$index!=0?\'\':\'in\'" aria-expanded="false" style="height: 72px;">\n\t\t\t<div class="panel-body">\n\t\t\t\t<div ng-bind-html="toTrustedHTML(faq.a)"></div>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n</div>')}]),angular.module("js/header/header.tpl.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("js/header/header.tpl.html",'<nav class="navbar navbar-default navbar-fixed-top">\n      <div class="container">\n        <div class="navbar-header">\n          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">\n            <span class="sr-only">Toggle navigation</span>\n            <span class="icon-bar"></span>\n            <span class="icon-bar"></span>\n            <span class="icon-bar"></span>\n          </button>\n      \t\t<a class="navbar-brand" href="{{baseURL}}">\n        \t\t<img alt="Raven" style="height:45px; width:auto; margin-top:-12px;" src="img/raven.png">\n      \t\t</a>\n      \t\t<b class="navbar-brand"><a href="{{baseURL}}" style="color:black; hover:black; active:black">Isle of Ravens</a></b>\n        </div>\n        <div id="navbar" class="navbar-collapse collapse" aria-expanded="false" style="height: 1px;">\n          <ul class="nav navbar-nav navbar-right">\n            <li active-link="active" link="{{baseURL}}"><a href="{{baseURL}}">Home</a></li>\n\t\t\t<li active-link="active" link="{{baseURL}}faq"><a href="{{baseURL}}faq">FAQ</a></li>\n\t\t\t<li active-link="active" link="{{baseURL}}contact"><a href="{{baseURL}}contact">Contact</a></li>\n          </ul>\n        </div>\x3c!--/.nav-collapse --\x3e\n      </div>\n</nav>\n\n\n\n\x3c!--\n<nav class="navbar navbar-default">\n\t<div class="container-fluid">\n    \t<div class="navbar-header">\n    \t\t<h3 class="visible-xs pull-right" style="margin-right:16px !important;"><a href="{{baseURL}}" style="color:black; hover:black; active:black">Isle of Ravens</a></h3>\n      \t\t<a class="navbar-brand" href="{{baseURL}}">\n        \t\t<img alt="Raven" style="height:45px; width:auto; margin-top:-6px;" src="img/raven.png">\n      \t\t</a>\n    \t</div>\n\t<div class="col-xs-8 hidden-xs" style="padding-bottom:4px !important;">\n\t\t<h2 style="margin-top:8px !important; margin-bottom:0px !important;"><a href="{{baseURL}}" style="color:black; hover:black; active:black">Isle of Ravens</a></h2>\n\t\t<i class="hidden-xs text-center" >Elo ranking and tournament details for AGoT LCG</i>\n\t</div>\n  \n  <div class="collapse navbar-collapse navbar-right" id="bs-example-navbar-collapse-1">\n\t<ul class="nav navbar-nav">\n\t\t<li><a href="{{baseURL}}" style="line-height:28px !important;">Home</a></li>\n\t\t<li><a href="{{baseURL}}faq" style="line-height:28px !important;">FAQ</a></li>\n\t\t<li><a href="{{baseURL}}contact" style="line-height:28px !important;">Contact</a></li>\n\t</ul>\n  </div>\n  </div>\n</nav>\n--\x3e\n')}]),angular.module("js/player/faction_winloss.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("js/player/faction_winloss.html",'<div id="fwl-{{player}}"></div>')}]),angular.module("js/player/player_details.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("js/player/player_details.html",'<div>\n\t<div class="panel-heading">\n\t\t<h2><a href="player/{{player.player_id}}">{{player.name}}</a> ({{player.elo}})</h2>\n\t</div>\n  \t<div class="panel-body">\n   \t\t<div class="row">\n   \t\t\t<div class="col-xs-6 col-md-3">\n   \t\t\t\t<div class="col-xs-12"><b>Entries</b></div>\n   \t\t\t\t<div class="col-xs-12">{{player.entries}}</div>\n   \t\t\t</div>\n\t\t\t<div class="col-xs-6 col-md-3">\n   \t\t\t\t<div class="col-xs-12"><b>Win</b></div>\n   \t\t\t\t<div class="col-xs-12">{{player.wins}}</div>\n   \t\t\t</div>\n\t\t\t<div class="col-xs-6 col-md-3">\n   \t\t\t\t<div class="col-xs-12"><b>Loss</b></div>\n   \t\t\t\t<div class="col-xs-12">{{player.losses}}</div>\n   \t\t\t</div>\n\t\t\t<div class="col-xs-6 col-md-3">\n   \t\t\t\t<div class="col-xs-12"><b>Win%</b></div>\n   \t\t\t\t<div class="col-xs-12">\n   \t\t\t\t\t<span ng-if="player.name == \'Gabriel Saravia\'">90%!!!</span>\n   \t\t\t\t\t<span ng-if="player.name != \'Gabriel Saravia\'">{{ ((player.wins/(player.wins+player.losses))*100).toFixed(2) }}%</span>\n   \t\t\t\t\t\n   \t\t\t\t</div>\n   \t\t\t</div>\n   \t\t</div>\n   \t\t\n   \t\t<div class="row">\n   \t\t\t<hr></hr>\n   \t\t\t<faction-winloss player="player.player_id">Loading ...</faction-winloss>\n   \t\t\t<hr></hr>\n   \t\t</div>\n\t\t   \t\t\n   \t\t<div class="row">\n   \t\t\t<div class="col-xs-12 col-md-6">\n   \t\t\t\t<player-nemesis player="player"></player-nemesis>\n   \t\t\t</div>\n\t\t   \t\t\t\n\t\t\t<div class="col-xs-12 col-md-6">\n\t\t\t\t<player-rival player="player"></player-rival>\n\t\t\t</div>\n\t\t   \t\t\t\n\t\t</div>\n\t\t   \t\t\n\t\t   \t\t<div class="row">\n\t\t   \t\t\t<div class="col-xs-12 text-center">\n\t\t\t\t\t\t<player-tournaments player="player"></player-tournaments>\n\t\t   \t\t\t</div>\n\t\t   \t\t</div>\n\t \t\t</div>\n</div>')}]),angular.module("js/player/player_nemesis.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("js/player/player_nemesis.html",'<div>\n\t<h3>Nemeses</h3>\n\t<table ng-if="player.nemeses.length > 0" class="table table-responsive">\n\t\t<tr>\n\t\t\t<td>Nemesis</td>\n\t\t\t<td>Win</td>\n\t\t\t<td>Loss</td>\n\t\t</tr>\n\t\t<tr ng-repeat="nemesis in player.nemeses">\n\t\t\t<td><a href="player/{{nemesis.winner_id}}">{{nemesis.name}} ({{nemesis.elo}})</a></td>\n\t\t\t<td>{{nemesis.rounds_played-nemesis.defeats}}\n\t\t\t<td>{{nemesis.defeats}}</td>\n\t\t</tr>\n\t</table>\n\t<i ng-if="player.nemeses.length < 1">Play more matches.  Make more enemies.</i>\n</div>')}]),angular.module("js/player/player_rival.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("js/player/player_rival.html",'<div>\n\t<h3>Rivals</h3>\n\t<table ng-if="player.rivals.length > 0" class="table table-responsive">\n\t\t<tr>\n\t\t\t<td>Rival</td>\n\t\t\t<td>Win</td>\n\t\t\t<td>Loss</td>\n\t\t</tr>\n\t\t<tr ng-repeat="rival in player.rivals">\n\t\t\t<td><a href="player/{{rival.loser_id}}">{{rival.name}} ({{rival.elo}})</a></td>\n\t\t\t<td>{{rival.wins}}\n\t\t\t<td>{{rival.rounds_played - rival.wins}}</td>\n\t\t</tr>\n\t</table>\n\t<i ng-if="player.rivals.length < 1">Play more matches.  BE the enemy.</i>\n</div>')}]),angular.module("js/player/player_rounds.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("js/player/player_rounds.html",'<div class="text-center">\n\t<a href="javascript:void(0);" class="collapsed" data-toggle="collapse" data-target="#collapseRounds-{{tid}}" aria-expanded="false" aria-controls="collapseExample">\n\t\t<span class="if-collapsed" ng-click="loadPlayerRounds()">Show Rounds</span>\n\t\t<span class="if-not-collapsed">Hide Rounds</span>\n\t</a>\n\t<div class="collapse text-left" id="collapseRounds-{{tid}}">\n\t\t<table class="table table-response">\n\t\t\t<tr>\n\t\t\t\t<td>Round#</td>\n\t\t\t\t<td>Result</td>\n\t\t\t\t<td>End Eol</td>\n\t\t\t\t<td>Start Eol</td>\n\t\t\t\t<td>Change</td>\n\t\t\t\t<td>Opponent</td>\n\t\t\t\t<td>End Eol</td>\n\t\t\t\t<td>Start Eol</td>\n\t\t\t\t<td>Change</td>\n\t\t\t</tr>\n\t\t\t<tbody>\n\t\t\t\t<tr ng-repeat="r in rounds">\n\t\t\t\t\t<td>{{r.round_number}}</td>\n\t\t\t\t\t<td>\n\t\t\t\t\t\t<span ng-if="r.winner_id == player.player_id" style="color:green">Win</span>\n\t\t\t\t\t\t<span ng-if="r.winner_id != player.player_id" style="color:red">Loss</span>\n\t\t\t\t\t</td>\n\t\t\t\t\t<td>\n\t\t\t\t\t\t<span ng-if="r.player_1_id == player.player_id">{{r.player_1_end_elo}}</span>\n\t\t\t\t\t\t<span ng-if="r.player_1_id != player.player_id">{{r.player_2_end_elo}}</span>\n\t\t\t\t\t</td>\n\t\t\t\t\t<td>\n\t\t\t\t\t\t<span ng-if="r.player_1_id == player.player_id">{{r.player_1_start_elo}}</span>\n\t\t\t\t\t\t<span ng-if="r.player_1_id != player.player_id">{{r.player_2_start_elo}}</span>\n\t\t\t\t\t</td>\n\t\t\t\t\t<td>\n\t\t\t\t\t\t<span ng-if="r.player_1_id == player.player_id">\n\t\t\t\t\t\t\t<span ng-if="r.player_1_end_elo-r.player_1_start_elo > 0" style="color:green">{{r.player_1_end_elo-r.player_1_start_elo}}</span>\n\t\t\t\t\t\t\t<span ng-if="r.player_1_end_elo-r.player_1_start_elo <= 0" style="color:red">{{r.player_1_end_elo-r.player_1_start_elo}}</span>\n\t\t\t\t\t\t</span>\n\t\t\t\t\t\t<span ng-if="r.player_2_id == player.player_id">\n\t\t\t\t\t\t\t<span ng-if="r.player_2_end_elo-r.player_2_start_elo > 0" style="color:green">{{r.player_2_end_elo-r.player_2_start_elo}}</span>\n\t\t\t\t\t\t\t<span ng-if="r.player_2_end_elo-r.player_2_start_elo <= 0" style="color:red">{{r.player_2_end_elo-r.player_2_start_elo}}</span>\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</td>\n\t\t\t\t\t<td><a href="player/{{r.opponent.player_id}}">{{r.opponent.name}}</a> ({{r.opponent.elo}})</td>\n\t\t\t\t\t<td>\n\t\t\t\t\t\t<span ng-if="r.player_1_id == player.player_id">{{r.player_2_end_elo}}</span>\n\t\t\t\t\t\t<span ng-if="r.player_1_id != player.player_id">{{r.player_1_end_elo}}</span>\n\t\t\t\t\t</td>\n\t\t\t\t\t<td>\n\t\t\t\t\t\t<span ng-if="r.player_1_id == player.player_id">{{r.player_2_start_elo}}</span>\n\t\t\t\t\t\t<span ng-if="r.player_1_id != player.player_id">{{r.player_1_start_elo}}</span>\n\t\t\t\t\t</td>\n\t\t\t\t\t<td>\n\t\t\t\t\t\t<span ng-if="r.player_1_id == player.player_id">\n\t\t\t\t\t\t\t<span ng-if="r.player_2_end_elo-r.player_2_start_elo > 0" style="color:green">{{r.player_2_end_elo-r.player_2_start_elo}}</span>\n\t\t\t\t\t\t\t<span ng-if="r.player_2_end_elo-r.player_2_start_elo <= 0" style="color:red">{{r.player_2_end_elo-r.player_2_start_elo}}</span>\n\t\t\t\t\t\t</span>\n\t\t\t\t\t\t<span ng-if="r.player_2_id == player.player_id">\n\t\t\t\t\t\t\t<span ng-if="r.player_1_end_elo-r.player_1_start_elo > 0" style="color:green">{{r.player_1_end_elo-r.player_1_start_elo}}</span>\n\t\t\t\t\t\t\t<span ng-if="r.player_1_end_elo-r.player_1_start_elo <= 0" style="color:red">{{r.player_1_end_elo-r.player_1_start_elo}}</span>\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</td>\n\t\t\t\t</tr>\n\t\t\t</tbody>\n\t\t</table>\n \t</div>\n \t<hr></hr>\n</div>')}]),angular.module("js/player/player_tournaments.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("js/player/player_tournaments.html",'<div>\n\t<a href="javascript:void(0);" class="collapsed" data-toggle="collapse" data-target="#collapseTournaments-{{player.player_id}}" aria-expanded="false" aria-controls="collapseExample">\n\t\t<span class="if-collapsed" ng-click="loadPlayerTournaments()">Show Tournaments</span>\n\t\t<span class="if-not-collapsed">Hide Tournaments</span>\n  \t</a>\n\t<div class="collapse text-left" id="collapseTournaments-{{player.player_id}}">\n  \t\t<div class="well">\n  \t\t\t<div class="row" ng-repeat="t in tournaments">\n\t  \t\t\t<h3 class="text-left">{{t.name}}</h3>\n    \t\t\t\n\t\t\t\t<div class="row">\n    \t\t\t\t<div class="col-xs-12">\n    \t\t\t\t\t<b>{{t.faction}} {{t.agenda}}</b><br/>\n    \t\t\t\t\t<span ng-if="t.end_elo > 0 && t.end_elo - t.start_elo > 0" style="color:green">{{t.end_elo - t.start_elo}}</span>\n    \t\t\t\t\t<span ng-if="t.end_elo > 0 && t.end_elo - t.start_elo <= 0"style="color:red">{{t.end_elo - t.start_elo}}</span>\n    \t\t\t\t\t<br/>\n    \t\t\t\t</div>\n    \t\t\t</div>\n    \t\t\t\n\t\t\t\t<div class="row">\n\t\t   \t\t\t<div class="col-xs-6 col-md-3">\n\t\t   \t\t\t\t<div class="col-xs-12"><b>End Elo</b></div>\n\t\t   \t\t\t\t<div class="col-xs-12">{{t.end_elo}}</div>\n\t\t   \t\t\t</div>\n\t\t\t\t\t<div class="col-xs-6 col-md-3">\n\t\t   \t\t\t\t<div class="col-xs-12"><b>Start Elo</b></div>\n\t\t   \t\t\t\t<div class="col-xs-12">{{t.start_elo}}</div>\n\t\t   \t\t\t</div>\n\t\t\t\t\t<div class="col-xs-6 col-md-3">\n\t\t   \t\t\t\t<div class="col-xs-12"><b>Players</b></div>\n\t\t   \t\t\t\t<div class="col-xs-12">{{t.player_count}}</div>\n\t\t   \t\t\t</div>\n\t\t\t\t\t<div class="col-xs-6 col-md-3">\n\t\t   \t\t\t\t<div class="col-xs-12"><b>Date</b></div>\n\t\t   \t\t\t\t<div class="col-xs-12">{{t.date_end}}</div>\n\t\t   \t\t\t</div>\n\t\t   \t\t</div>\n\t\t   \t\t<player-rounds tid="t.tournament_id" player="player"></player-rounds>\n\t\t   \t\t\n   \t\t\t</div>\n  \t\t\n  \t\t</div>\n  \t</div>\n</div>')}]),angular.module("js/player/top_players.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("js/player/top_players.html",'<div>\n\t<h3>Top Players</h3>\n\t<table class="table table-responsive table-hover table-striped">\n\t\t<thead>\n\t\t\t<tr>\n\t\t\t\t<th>#</th>\n\t\t\t\t<th>Name</th>\n\t\t\t\t<th>Elo</th>\n\t\t\t\t<th>Wins</th>\n\t\t\t\t<th>Losses</th>\n\t\t\t\t<th>Entries</th>\n\t\t\t\t<th>Most Played</th>\n\t\t\t</tr>\n\t\t</thead>\n\t\t<tbody>\n\t\t\t<tr ng-repeat="player in top_players">\n\t\t\t\t<td>{{$index+1+pagination.offset}}</td>\n\t\t\t\t<td><a href="player/{{player.player_id}}">{{player.name}}</a></td>\n\t\t\t\t<td>{{player.elo}}</td>\n\t\t\t\t<td>{{player.wins}}</td>\n\t\t\t\t<td>{{player.losses}}</td>\n\t\t\t\t<td>{{player.entries}}</td>\n\t\t\t\t<td>{{player.most_played_faction}}</td>\n\t\t\t</tr>\n\t\t</tbody>\n\t</table>\n\t<div class="text-center">\n\t\t<ul ng-if="pagination.total" uib-pagination total-items="pagination.total" items-per-page="20" ng-model="pagination.page" max-size="10" ng-change="changePage()" class="pagination-sm" boundary-link-numbers="true"></ul>\n\t</div>\n</div>')}]),angular.module("js/search/main.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("js/search/main.html",'<style>\n[data-toggle="collapse"].collapsed .if-not-collapsed {\n  display: none;\n}\n[data-toggle="collapse"]:not(.collapsed) .if-collapsed {\n  display: none;\n}\n</style>\n\n<div class="clearfix"></div>\n\n<div ng-if="loading">Loading...</div>\n\n<div ng-if="players.length <= 0 && !loading">\n\t<top-players page="page">Loading...</top-players>\n</div>\n\n<div ng-if="players.length > 0 && !loading">\n\n\t\n\t\t<div ng-repeat="player in players">\n\t\t\t<div class="panel panel-default">\n\t\t\t\t<player-details player="player"></player-details>\n\t\t\t</div>\n\t\t\t<br/>\n\t\t</div>\n</div>\n')}]),angular.module("js/search/search_form.tpl.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("js/search/search_form.tpl.html",'<div class="row">\n\t<div class="text-right">\n\t\t<form class="form-inline">\n\t\t  <div class="form-group">\n\t\t      <input type="text" class="form-control" id="playerSearch" name="name" placeholder="Player Name" ng-model="ps.search_str" />\n\t\t  </div>\n\t\t  <button ng-click="searchPlayer()" class="btn btn-small btn-default">Search</button>\n\t\t</form>\n\t</div>\n</div>')}]),angular.module("js/search/search.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("js/search/search.html",'<style>\n[data-toggle="collapse"].collapsed .if-not-collapsed {\n  display: none;\n}\n[data-toggle="collapse"]:not(.collapsed) .if-collapsed {\n  display: none;\n}\n</style>\n\n<div ng-if="loading">Loading...</div>\n\n<div ng-if="ps.players.length > 0 && !loading">\n\t\n\t\t<div ng-repeat="player in ps.players">\n\t\t\t<div class="panel panel-default">\n\t\t\t\t<player-details player="player"></player-details>\n\t\t\t</div>\n\t\t\t<br/>\n\t\t</div>\n</div>\n')}]),app.directive("topPlayers",["Restangular","$routeParams","$route","$location","$q","Api",function(Rest,$routeParams,$route,$location,$q,Api){"use strict";return{restrict:"EA",replace:!0,transclude:!1,templateUrl:"js/player/top_players.html",scope:{page:"=",mode:"&"},link:function(scope,elem,attrs){scope.pagination={offset:0,limit:20,page:scope.page},scope.loaded=!1,scope.loadTopPlayers=function(){scope.pagination.offset=scope.pagination.limit*(scope.pagination.page-1),Api.loadTopPlayers(scope.pagination).then(function(res){scope.top_players=res.data.players,scope.pagination.total=res.data.total.total,scope.pagination.page=scope.pagination.offset/scope.pagination.limit+1})},scope.changePage=function(){$location.path("/page/"+scope.pagination.page)},scope.loadTopPlayers()}}}]),app.directive("playerDetails",[function(){"use strict";return{restrict:"EA",replace:!0,transclude:!1,templateUrl:"js/player/player_details.html",scope:{player:"=",mode:"&"}}}]),app.directive("playerNemesis",[function(){"use strict";return{restrict:"EA",replace:!0,transclude:!1,templateUrl:"js/player/player_nemesis.html",scope:{player:"=",mode:"&"}}}]),app.directive("playerRival",[function(){"use strict";return{restrict:"EA",replace:!0,transclude:!1,templateUrl:"js/player/player_rival.html",scope:{player:"=",mode:"&"}}}]),app.directive("playerTournaments",["Api",function(Api){"use strict";return{restrict:"EA",replace:!0,transclude:!1,templateUrl:"js/player/player_tournaments.html",scope:{player:"=",mode:"&"},link:function(scope,element,attrs){scope.loadPlayerTournaments=function(){console.log("loading!"),Api.loadTournamentsByPlayer(scope.player.player_id).then(function(res){scope.tournaments=res.data,console.log(scope.tournaments)})}}}}]),app.directive("playerRounds",["Api",function(Api){"use strict";return{restrict:"EA",replace:!0,transclude:!1,templateUrl:"js/player/player_rounds.html",scope:{tid:"=",player:"=",mode:"&"},link:function(scope,element,attrs){scope.loadPlayerRounds=function(){console.log("loading! - "+scope.tid+" -- "+scope.player.player_id),Api.loadTournamentRoundsByPlayer(scope.tid,scope.player.player_id).then(function(res){scope.rounds=res.data,console.log(scope.tournaments)})}}}}]),app.directive("factionWinloss",["Api",function(Api){"use strict";return{restrict:"EA",replace:!0,transclude:!1,templateUrl:"js/player/faction_winloss.html",scope:{player:"=",mode:"&"},link:function(scope,elem,attrs){scope.loadFactionWinLoss=function(player){Api.loadFactionWinLoss(player).then(function(res){scope.result=res.data,scope.buildChart()})},scope.buildChart=function(){function drawStacked(){var data=new google.visualization.DataTable;data.addColumn("string","Faction"),data.addColumn("number","Wins"),data.addColumn({type:"string",role:"tooltip"}),data.addColumn("number","Losses"),data.addColumn({type:"string",role:"tooltip"});var myData=[];angular.forEach(scope.result,function(value,key){myData.push([value.faction,value.wins,value.wins+" Wins in "+value.entries+" Matches",value.losses,value.losses+" Losses in "+value.entries+" Matches"])}),data.addRows(myData);var options={tooltip:{isHtml:!0},legend:!1,isStacked:!0};new google.visualization.BarChart(document.getElementById("fwl-"+scope.player)).draw(data,options)}google.charts.setOnLoadCallback(drawStacked)},scope.loadFactionWinLoss(scope.player)}}}]),app.factory("PlayerSearch",["Restangular","$rootScope","$q","$location","$http","Api",function(Rest,$rootScope,$q,$location,$http,Api){"use strict";window.Api=this;return{setSearchStr:function(search_str){console.log("setting search str : "+search_str),this.search_str=search_str,console.log("after setting?"),console.log(this.search_str)},searchPlayers:function(){var that=this,defer=$q.defer();return Api.searchPlayers({playerName:that.search_str}).then(function(res){console.log("returning with that.players??"),that.players=res.data,console.log(that.players),defer.resolve(res.data)},function(err){defer.reject(err)}),defer.promise}}}]);var MainCtrl=app.controller("SearchController",["$scope","Restangular","$routeParams","$route","$location","$q","Api","PlayerSearch",function($scope,Rest,$routeParams,$route,$location,$q,Api,PlayerSearch){$scope.ps=PlayerSearch,$scope.players=$scope.ps.players,$scope.loading=!1}]);app.directive("playerSearch",["Restangular","$routeParams","$route","$location","$q","Api","PlayerSearch",function(Rest,$routeParams,$route,$location,$q,Api,PlayerSearch){"use strict";return{restrict:"EA",replace:!0,transclude:!1,templateUrl:"js/search/search_form.tpl.html",scope:{page:"=",mode:"&"},link:function(scope,elem,attrs){console.log("IN PLAYER SEARCH DIRECTIVE!!!!"),scope.ps=PlayerSearch,scope.pagination={offset:0,limit:20,page:scope.page},scope.loaded=!1,scope.searchPlayer=function(){console.log("search player!"),scope.ps.searchPlayers().then(function(){$location.path("/search")})},scope.ps.search_str&&scope.searchPlayer()}}}]);var FaqCtrl=app.controller("FaqController",["$scope","Restangular","$routeParams","$route","$location","$q","Api","$sce",function($scope,Rest,$routeParams,$route,$location,$q,Api,$sce){$scope.loading=!1,$scope.faqs=[{id:1,q:"What is Isle of Ravens?",a:'Isle of Ravens is a site that collects tournament entries for A Game of Thrones LCG 2nd edition and generates an Elo rating for each player based on their performance.  Data is sourced from <a href="http://thejoustingpavilion.com" target="_blank">The Jousting Pavilion</a> and fetches new results hourly.  Due to API limitations, we can only pull in data for completed tournaments.'},{id:2,q:"What is an Elo Rating",a:"Officially, 'The Elo rating system is a method for calculating the relative skill levels of players in competitor-versus-competitor games such as chess. It is named after its creator Arpad Elo, a Hungarian-born American physics professor.'"},{id:3,q:"Where does this data come from and how often is it updated?",a:'IoR will check for new entries on <a href="http://thejoustingpavilion.com" target="_blank">The Jousting Pavilion</a> every hour and generate updated Elo ratings based on the new results.  At this time we can only pull in data for completed tournaments, so your Elo will not updated until the end of an event.'},{id:4,q:"I had my name merged on TJP, when will my Elo update?",a:"You will have to notify us when a historical change happens.  Because a single change in a player or tournament ripples through the data, effecting an increasingly branching set of Elo ratings, we have to re-run all of the data.  To be kind to the data sources we rely on, this is only done per request and not automatically."},{id:5,q:"I had a tournament for a different game deleted from TJP, when will my Elo Update?",a:"You will have to notify us when a historical change happens.  Because a single change in a player or tournament ripples through the data, effecting an increasingly branching set of Elo ratings, we have to re-run all of the data.  To be kind to the data sources we rely on, this is only done per request and not automatically."},{id:6,q:"Why did tournament X not affect my Elo?",a:"Elo ratings depend on round by round data being available.  If this there are no rounds available, we can't calculate a new Elo."}],$scope.toTrustedHTML=function(html){return $sce.trustAsHtml(html)}}]),ContactCtrl=app.controller("ContactController",["$scope","Restangular","$routeParams","$route","$location","$q","Api","$sce","$http",function($scope,Rest,$routeParams,$route,$location,$q,Api,$sce,$http){$scope.success=!1,$scope.error=!1,$scope.sending=!1,$scope.user={},$scope.send=function(){$scope.sending=!0,Api.sendMail($scope.user).then(function(res){console.log(res),console.log($scope.user),$scope.success=!0,$scope.error=!1},function(response){$scope.error=!0,$scope.success=!1,console.log("Error with status code",response.status)})}}]);app.directive("activeLink",["$location",function(location){return{restrict:"A",link:function(scope,element,attrs,controller){var clazz=attrs.activeLink,path="/"+attrs.link;console.log("checking path of "+path),scope.location=location,scope.$watch("location.path()",function(newPath){path===newPath?element.addClass(clazz):element.removeClass(clazz)})}}}]);